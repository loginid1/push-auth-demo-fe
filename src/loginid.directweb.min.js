/* eslint-disable */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("LoginID",[],t):"object"==typeof exports?exports.LoginID=t():(e.LoginID=e.LoginID||{},e.LoginID.directweb=t())}(self,(function(){return(()=>{"use strict";var e={910:(e,t,n)=>{n.r(t),n.d(t,{DirectWeb:()=>l,default:()=>u});var o=n(655);const i=e=>e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),r={bad_request:"Bad request",user_already_registered:"Username unavailable",client_not_created:"Client not created",client_not_updated:"Client not updated",client_not_deleted:"Client not deleted",client_not_activated:"Client not activated",client_not_deactivated:"Client not deactivated",client_not_verified:"Client not verified",client_history_not_created:"Client history not created",oidc_client_not_created:"OIDC client not created",oidc_client_not_deleted:"OIDC client not deleted",oidc_organization_not_found:"OIDC organization not found",oidc_scope_not_allowed:"OIDC scope not allowed",hydra_client_not_created:"Hydra client not created",hydra_client_not_deleted:"Hydra client not deleted",username_taken:"Username Unavailable",username_empty:"Username Empty",username_invalid:"Username Invalid",user_not_created:"User not created",user_not_updated:"User not updated",user_not_verified:"User not verified",credential_not_created:"Credential not created",user_activity_not_recorded:"User activity not recorded",user_device_not_created:"User device not created",request_validation_error:"Request Validation Error",query_failed:"Query Failed",missing_parameter:"Missing Parameter",failed_to_send_email:"Failed to send email",invalid_registration_code:"Invalid Registration Code",invalid_access_code:"Invalid Access Code",invalid_registration_link:"Invalid registration link",expired_registration_link:"Expired registration link",too_manny_registration_attempts:"Too many registration attempts",failed_to_authenticate:"Failed to authenticate",unauthorized:"Unauthorized",operation_not_allowed:"You do not have a permission to complete this action.",invalid_credential:"Invalid credentials",insufficient_license:"You do not have permission to complete this action. Please sign the appropriate agreements.",invalid_jwt:"Invalid token",forbidden:"Forbidden",endpoint_deprecated:"Error code: D3TVC3RP3D",not_found:"Not found",oidc_client_not_found:"OIDC client not found",authenticator_not_found:"Authenticator not found",client_not_found:"Client not found",user_not_found:"User not found",user_device_not_found:"User device not found",credential_not_found:"Credential not found",not_acceptable:"Unacceptable",oidc_max_client_reached:"OIDC max client limit reached",internal_server_error:"An Internal Error has occurred",database_error:"A Major Internal Error has occurred",missing_body:"Missing body",missing_authentication_method:"Missing Authentication",oidc_server_error:"OIDC server error",account_deactivated:"Account is deactivated"},a=e=>{const t=r[e];return void 0!==t?t:"An unknown error has occurred"};class d extends Error{constructor(e,t,n){super(t),this.name="LoginSDK-Error",this.code=e,this.errors=n}}class s extends Error{constructor(){super("Your Identity could not be verified"),this.name="NavigatorError"}}const c={encoding:{base64EncodeUrl:i,base64ToBuffer:e=>{const t=(e=>{let t,n,o,i={},r=0,a=0,d="",s=String.fromCharCode,c=e.length;for(t=0;64>t;t++)i["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)]=t;for(n=0;c>n;n++)for(t=i[e.charAt(n)],r=(r<<6)+t,a+=6;a>=8;)((o=255&r>>>(a-=8))||c-2>n)&&(d+=s(o));return d})(e=e.replace(/-/g,"+").replace(/_/g,"/")),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n.buffer},bufferToBase64:e=>{let t="";const n=new Uint8Array(e);for(let e=0;e<n.byteLength;e++)t+=String.fromCharCode(n[e]);const o=(e=>{let t,n,o,i,r,a,d,s,c,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=0,_=0,f="",h=[];if(!e)return e;do{t=e.charCodeAt(u++),n=e.charCodeAt(u++),o=e.charCodeAt(u++),s=t<<16|n<<8|o,i=63&s>>18,r=63&s>>12,a=63&s>>6,d=63&s,h[_++]=l.charAt(i)+l.charAt(r)+l.charAt(a)+l.charAt(d)}while(u<e.length);return f=h.join(""),c=e.length%3,(c?f.slice(0,c-3):f)+"===".slice(c||3)})(t);return i(o)}},errors:{SDKError:d,NavigatorError:s,getErrorMessageByCode:a},http:{post:(e,t,n)=>(0,o.mG)(void 0,void 0,void 0,(function*(){const o={method:"post",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},i=yield fetch(e+t,o),r=yield i.json();if(i.ok)return r;const{code:s}=r;throw new d(s,a(s),[])}))},navigator:{getCredential:e=>(0,o.mG)(void 0,void 0,void 0,(function*(){try{const t=yield navigator.credentials.get(e);if(null!==t)return t}catch(e){throw console.log(e),new s}throw new s})),createCredential:e=>(0,o.mG)(void 0,void 0,void 0,(function*(){try{const t=yield navigator.credentials.create(e);if(null!==t)return t}catch(e){throw console.log(e),new s}throw new s}))}};class l{constructor(e,t){this._baseURL=e,this._apiKey=t}register(e,t=null){return(0,o.mG)(this,void 0,void 0,(function*(){const t=localStorage.getItem("register_session_id"),n={clientId:this._apiKey,sessionId:t||"",udata:e};let i=yield c.http.post(this._baseURL,"/registerRequest",n);const{uid:r,session_id:a,ipsidy_redirect:d}=i,s=(0,o._T)(i,["uid","session_id","ipsidy_redirect"]);localStorage.setItem("register_session_id",a);const{challenge:l}=s;s.challenge=c.encoding.base64ToBuffer(s.challenge),s.user.id=c.encoding.base64ToBuffer(s.user.id);const u=yield c.navigator.createCredential({publicKey:s}),_=u.response,f={clientId:this._apiKey,uid:r,challenge:l,udata:e,keyHandle:c.encoding.bufferToBase64(u.rawId),clientData:c.encoding.bufferToBase64(_.clientDataJSON),attestData:c.encoding.bufferToBase64(_.attestationObject)};return yield c.http.post(this._baseURL,"/registerAttest",f)}))}login(e,t=null){return(0,o.mG)(this,void 0,void 0,(function*(){let n=Object.assign({clientId:this._apiKey,username:e},t&&{security_code:t.securityCode});if((null==t?void 0:t.userDetection)&&!(yield c.http.post(this._baseURL,"/user/detection",n)).user_detected)throw new c.errors.SDKError("user_detection","user not detected","");let o=yield c.http.post(this._baseURL,"/verifyRequest",n);const{challenge:i}=o;if(o.challenge=c.encoding.base64ToBuffer(o.challenge),o.allowCredentials)for(const e of o.allowCredentials)e.id=c.encoding.base64ToBuffer(e.id);const r=yield c.navigator.getCredential({publicKey:o}),a=r.response,d=Object.assign({clientId:this._apiKey,challenge:i,username:e,udata:e,keyHandle:c.encoding.bufferToBase64(r.rawId),clientData:c.encoding.bufferToBase64(a.clientDataJSON),authData:c.encoding.bufferToBase64(a.authenticatorData),signData:c.encoding.bufferToBase64(a.signature)},t&&{security_code:t.securityCode});return yield c.http.post(this._baseURL,"/verifySign",d)}))}pushAuthentication(e,t){return(0,o.mG)(this,void 0,void 0,(function*(){const n={client_id:this._apiKey,username:e};let o=yield c.http.post(this._baseURL,"/push_authentication/init",n);const{code:i,devices:r,communication:a}=o;t(i,r,a);const d=Object.assign(Object.assign({},n),{security_code:{code:i}});return yield c.http.post(this._baseURL,"/push_authentication/complete",d)}))}createTransaction(e,t){return(0,o.mG)(this,void 0,void 0,(function*(){const n={username:e,client_id:this._apiKey,tx_type:"text",tx_payload:JSON.stringify(t)},o=yield c.http.post(this._baseURL,"/tx/init",n),i=o.assertion_options,r=o.tx_id,{challenge:a}=i;if(i.challenge=c.encoding.base64ToBuffer(i.challenge),i.allowCredentials)for(const e of i.allowCredentials)e.id=c.encoding.base64ToBuffer(e.id);const d=yield c.navigator.getCredential({publicKey:i}),s=d.response;let l={username:e,tx_id:r,client_id:this._apiKey,challenge:a,key_handle:c.encoding.bufferToBase64(d.rawId),client_data:c.encoding.bufferToBase64(s.clientDataJSON),auth_data:c.encoding.bufferToBase64(s.authenticatorData),sign_data:c.encoding.bufferToBase64(s.signature)};return yield c.http.post(this._baseURL,"/tx/complete",l)}))}}const u=l},655:(e,t,n)=>{function o(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}function i(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{s(o.next(e))}catch(e){r(e)}}function d(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,d)}s((o=o.apply(e,t||[])).next())}))}n.d(t,{_T:()=>o,mG:()=>i}),Object.create,Object.create}},t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(910)})()}));
